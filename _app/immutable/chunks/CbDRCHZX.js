import{w as T,s as I,h as O,t as A,o as F,l as L}from"./P09vINOn.js";import S from"./CfZphoad.js";import{v as V,S as _,f as k,m as y}from"./1VrzQugo.js";function B(t,n){return q(t,{})||{type:"root",children:[]}}function q(t,n){const i=K(t,n);return i&&n.afterTransform&&n.afterTransform(t,i),i}function K(t,n){switch(t.nodeType){case 1:return X(t,n);case 3:return R(t);case 8:return U(t);case 9:return $(t,n);case 10:return H();case 11:return $(t,n);default:return}}function $(t,n){return{type:"root",children:b(t,n)}}function H(){return{type:"doctype"}}function R(t){return{type:"text",value:t.nodeValue||""}}function U(t){return{type:"comment",value:t.nodeValue||""}}function X(t,n){const i=t.namespaceURI,a=i===T.svg?I:O,e=i===T.html?t.tagName.toLowerCase():t.tagName,l=i===T.html&&e==="template"?t.content:t,s=t.getAttributeNames(),p={};let o=-1;for(;++o<s.length;)p[s[o]]=t.getAttribute(s[o])||"";return a(e,p,b(l,n))}function b(t,n){const i=t.childNodes,a=[];let e=-1;for(;++e<i.length;){const l=q(i[e],n);l!==void 0&&a.push(l)}return a}new DOMParser;function j(t,n){const i=G(t);return B(i)}function G(t){const n=document.createElement("template");return n.innerHTML=t,n.content}const J={},Q=[];function ct(t){const n=t||J;return function(i,a){V(i,"element",function(e,l){const s=Array.isArray(e.properties.className)?e.properties.className:Q,p=s.includes("language-math"),o=s.includes("math-display"),c=s.includes("math-inline");let h=o;if(!p&&!o&&!c)return;let m=l[l.length-1],f=e;if(e.tagName==="code"&&p&&m&&m.type==="element"&&m.tagName==="pre"&&(f=m,m=l[l.length-2],h=!0),!m)return;const d=A(f,{whitespace:"pre"});let x;try{x=S.renderToString(d,{...n,displayMode:h,throwOnError:!0})}catch(g){const M=g,r=M.name.toLowerCase();a.message("Could not render math with KaTeX",{ancestors:[...l,e],cause:M,place:e.position,ruleId:r,source:"rehype-katex"});try{x=S.renderToString(d,{...n,displayMode:h,strict:"ignore",throwOnError:!1})}catch{x=[{type:"element",tagName:"span",properties:{className:["katex-error"],style:"color:"+(n.errorColor||"#cc0000"),title:String(g)},children:[{type:"text",value:d}]}]}}typeof x=="string"&&(x=j(x).children);const u=m.children.indexOf(f);return m.children.splice(u,1,...x),_})}}function W(){return{enter:{mathFlow:t,mathFlowFenceMeta:n,mathText:l},exit:{mathFlow:e,mathFlowFence:a,mathFlowFenceMeta:i,mathFlowValue:p,mathText:s,mathTextData:p}};function t(o){const c={type:"element",tagName:"code",properties:{className:["language-math","math-display"]},children:[]};this.enter({type:"math",meta:null,value:"",data:{hName:"pre",hChildren:[c]}},o)}function n(){this.buffer()}function i(){const o=this.resume(),c=this.stack[this.stack.length-1];F(c.type==="math"),c.meta=o}function a(){this.data.mathFlowInside||(this.buffer(),this.data.mathFlowInside=!0)}function e(o){const c=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),h=this.stack[this.stack.length-1];F(h.type==="math"),this.exit(o),h.value=c;const m=h.data.hChildren[0];F(m.type==="element"),F(m.tagName==="code"),m.children.push({type:"text",value:c}),this.data.mathFlowInside=void 0}function l(o){this.enter({type:"inlineMath",value:"",data:{hName:"code",hProperties:{className:["language-math","math-inline"]},hChildren:[]}},o),this.buffer()}function s(o){const c=this.resume(),h=this.stack[this.stack.length-1];F(h.type==="inlineMath"),this.exit(o),h.value=c,h.data.hChildren.push({type:"text",value:c})}function p(o){this.config.enter.data.call(this,o),this.config.exit.data.call(this,o)}}function Y(t){let n=(t||{}).singleDollarTextMath;return n==null&&(n=!0),a.peek=e,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:n?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:i,inlineMath:a}};function i(l,s,p,o){const c=l.value||"",h=p.createTracker(o),m="$".repeat(Math.max(L(c,"$")+1,2)),f=p.enter("mathFlow");let d=h.move(m);if(l.meta){const x=p.enter("mathFlowMeta");d+=h.move(p.safe(l.meta,{after:`
`,before:d,encode:["$"],...h.current()})),x()}return d+=h.move(`
`),c&&(d+=h.move(c+`
`)),d+=h.move(m),f(),d}function a(l,s,p){let o=l.value||"",c=1;for(n||c++;new RegExp("(^|[^$])"+"\\$".repeat(c)+"([^$]|$)").test(o);)c++;const h="$".repeat(c);/[^ \r\n]/.test(o)&&(/^[ \r\n]/.test(o)&&/[ \r\n]$/.test(o)||/^\$|\$$/.test(o))&&(o=" "+o+" ");let m=-1;for(;++m<p.unsafe.length;){const f=p.unsafe[m];if(!f.atBreak)continue;const d=p.compilePattern(f);let x;for(;x=d.exec(o);){let u=x.index;o.codePointAt(u)===10&&o.codePointAt(u-1)===13&&u--,o=o.slice(0,u)+" "+o.slice(x.index+1)}}return h+o+h}function e(){return"$"}}const Z={tokenize:tt,concrete:!0,name:"mathFlow"},z={tokenize:et,partial:!0};function tt(t,n,i){const a=this,e=a.events[a.events.length-1],l=e&&e[1].type==="linePrefix"?e[2].sliceSerialize(e[1],!0).length:0;let s=0;return p;function p(r){return t.enter("mathFlow"),t.enter("mathFlowFence"),t.enter("mathFlowFenceSequence"),o(r)}function o(r){return r===36?(t.consume(r),s++,o):s<2?i(r):(t.exit("mathFlowFenceSequence"),k(t,c,"whitespace")(r))}function c(r){return r===null||y(r)?m(r):(t.enter("mathFlowFenceMeta"),t.enter("chunkString",{contentType:"string"}),h(r))}function h(r){return r===null||y(r)?(t.exit("chunkString"),t.exit("mathFlowFenceMeta"),m(r)):r===36?i(r):(t.consume(r),h)}function m(r){return t.exit("mathFlowFence"),a.interrupt?n(r):t.attempt(z,f,g)(r)}function f(r){return t.attempt({tokenize:M,partial:!0},g,d)(r)}function d(r){return(l?k(t,x,"linePrefix",l+1):x)(r)}function x(r){return r===null?g(r):y(r)?t.attempt(z,f,g)(r):(t.enter("mathFlowValue"),u(r))}function u(r){return r===null||y(r)?(t.exit("mathFlowValue"),x(r)):(t.consume(r),u)}function g(r){return t.exit("mathFlow"),n(r)}function M(r,v,N){let E=0;return k(r,P,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4);function P(w){return r.enter("mathFlowFence"),r.enter("mathFlowFenceSequence"),C(w)}function C(w){return w===36?(E++,r.consume(w),C):E<s?N(w):(r.exit("mathFlowFenceSequence"),k(r,D,"whitespace")(w))}function D(w){return w===null||y(w)?(r.exit("mathFlowFence"),v(w)):N(w)}}}function et(t,n,i){const a=this;return e;function e(s){return s===null?n(s):(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),l)}function l(s){return a.parser.lazy[a.now().line]?i(s):n(s)}}function nt(t){let i=(t||{}).singleDollarTextMath;return i==null&&(i=!0),{tokenize:a,resolve:rt,previous:at,name:"mathText"};function a(e,l,s){let p=0,o,c;return h;function h(u){return e.enter("mathText"),e.enter("mathTextSequence"),m(u)}function m(u){return u===36?(e.consume(u),p++,m):p<2&&!i?s(u):(e.exit("mathTextSequence"),f(u))}function f(u){return u===null?s(u):u===36?(c=e.enter("mathTextSequence"),o=0,x(u)):u===32?(e.enter("space"),e.consume(u),e.exit("space"),f):y(u)?(e.enter("lineEnding"),e.consume(u),e.exit("lineEnding"),f):(e.enter("mathTextData"),d(u))}function d(u){return u===null||u===32||u===36||y(u)?(e.exit("mathTextData"),f(u)):(e.consume(u),d)}function x(u){return u===36?(e.consume(u),o++,x):o===p?(e.exit("mathTextSequence"),e.exit("mathText"),l(u)):(c.type="mathTextData",d(u))}}}function rt(t){let n=t.length-4,i=3,a,e;if((t[i][1].type==="lineEnding"||t[i][1].type==="space")&&(t[n][1].type==="lineEnding"||t[n][1].type==="space")){for(a=i;++a<n;)if(t[a][1].type==="mathTextData"){t[n][1].type="mathTextPadding",t[i][1].type="mathTextPadding",i+=2,n-=2;break}}for(a=i-1,n++;++a<=n;)e===void 0?a!==n&&t[a][1].type!=="lineEnding"&&(e=a):(a===n||t[a][1].type==="lineEnding")&&(t[e][1].type="mathTextData",a!==e+2&&(t[e][1].end=t[a-1][1].end,t.splice(e+2,a-e-2),n-=a-e-2,a=e+2),e=void 0);return t}function at(t){return t!==36||this.events[this.events.length-1][1].type==="characterEscape"}function it(t){return{flow:{36:Z},text:{36:nt(t)}}}const ot={};function ht(t){const n=this,i=t||ot,a=n.data(),e=a.micromarkExtensions||(a.micromarkExtensions=[]),l=a.fromMarkdownExtensions||(a.fromMarkdownExtensions=[]),s=a.toMarkdownExtensions||(a.toMarkdownExtensions=[]);e.push(it(i)),l.push(W()),s.push(Y(i))}export{ht as a,ct as r};
